\documentclass[11pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage[left=2.5cm,top=3cm,right=2.5cm,bottom=3cm,bindingoffset=0.5cm]{geometry}
\usepackage{AEDLogica, AEDEspecificacion, AEDTADs}
\usepackage{caratula}


\titulo{Trabajo práctico N°1}
\subtitulo{Especificacion de TADs}

\fecha{\today}

\materia{Algoritmos y Estructuras de Datos}
\grupo{BobElConstructorPorCopia}

\integrante{Choque, Leandro}{252/25}{leandroch2002@gmail.com}
\integrante{Musi, Santino}{965/24}{santinomusi1@gmail.com}
\integrante{Rojas, Damian}{209/25}{dam.rojas1@gmail.com}
\integrante{Martell, Juan Bautista}{622/25}{juanbamartell@hotmail.com}
% \integrante{Apellido, Nombre2}{002/01}{email2@dominio.com} %


% Declaramos donde van a estar las figuras
% No es obligatorio, pero suele ser comodo
\graphicspath{{../static/}}

% Asi pueden escribir nuevos comandos. 
% Este por ejemplo asegura q los nombres 
% que figuren con una tipografia diferenciada  
\newcommand{\Tipo}[1]{\mathsf{#1}}
% la sintaxis es \newcommand{\nombreDeLaMacro}[cantidadDeParametros]{Lo que va ser remplazado por el macro} 
\newcommand{\norm}[1]{\vert #1\vert}

% Empieza el documento
\begin{document}

\maketitle

\section{Aclaraciones}

Tomamos un asiento vacío en el aula como un struct Alumno con examen = $\seq{}$.\\

En proc \textit{chequearCopias}, en el aux \textit{porcentajeRespuestasIgualAdyacente} aseguramos que se cuenten las respuestas vacías como coincidencias, debido a la aclaración de uno de los profesores, y en aux porcentajeIgualAula comparamos el examen entero con el \textbf{resto} del alumnado según lo especificado en la consigna.

\section{Especificacion}

$Nota\ ES\ \R$\\
$Respuesta\ ES\ \Z$\\
$Examen\ ES\ \seq{Respuesta}$\\
$Alumno\ ES\ struct\struct{f:\Z, c:\Z}$\\
%$Alumno\ ES\ struct\struct{coord:Alumno, examen:Examen}$\\
$Aula\ ES\ dicc\struct{Alumno, Examen}$\\
\\
% Acá arrancamos el TAD --------------------------------------------------
\begin{tad}{EdR}

% SECCIÓN DE DUDAS/COMENTARIOS --------

% RENOMBRE DE TIPOS --------------------------------------------------

% Aula: Seq[Seq[Alumno]] - Doble secuencia para representar
% Alumno: Struct {coord: Alumno, examen: Examen}
% Alumno: Struct{f:Z, c:Z}
% Examen: Seq[Respuesta]
% Respuesta: Char
% Nota: Z

\obs{aula}{Aula}
\\
\obs{solucion}{Examen}
\\
\obs{entregas}{Aula}

\subsection{proc EdR}
% Metodo EdR --------------------------------------------------

\begin{proc}{EdR}
{
\In dimensionAula: \Z,
\In s: Examen,
\In cantEstudiantes: \Z
}{
\Tipo{EdR}
}
    \requiereLargo{
    dimensionAula > 0 \land
    \\ rtaValida(s) \land
    \\ cantValidaEstudiantes(dimensionAula, cantEstudiantes)}
    \aseguraLargo{
    \norm{res.aula} = cantEstudiantes \land\\
    coordenadasValidas(res.aula, dimensionAula) \land
    \\ examenesInicializados(res.aula, s) \land
    \\ noHayAlumnosJuntos(res.aula) \land
    \\ res.solucion = s \land 
    \\ res.entregas = dicc\struct{}}
\end{proc}

% Las respuestas del examen estan en el rango de opciones
\pred{rtaValida}{s: Examen}{
    \paraTodo{i}{\Z}{0 \leq i < \norm{s} \implicaLuego 0 \leq s[i] \leq 9}
}

\predLargo{coordenadasValida}{a:Aula, n: \Z}{
    \paraTodo{c}{Alumno}{c\in a \rightarrow (0 \leq c.c < n \land 0 \leq c.f < n)}
}

% si c y f estan entre las dimensiones de aula la Alumno es valida 
% REMPLAZAR TODAS LAS APARICIONES CON "c \in a"
% \predLargo{coordenadaValida}{coord:Alumno, a:Aula}{0 \leq coord.f < \norm{a} \land 0 \leq coord.c < \norm{a}}
% \\
%Chequea que la cantidad de estudiantes sea menor o igual a los que entran en el aula manteniendo la separación de al menos 1 asiento entre cada uno \\
\predLargo{cantValidaEstudiantes}{a, c: \Z}{
    (0 \leq c \leq ifThenElse(mod(a,2)=0, \frac{a^ 2}{2}, \frac{a^ 2 + a}{2}))    
}\\
% si hay un alumno en el asiento entonces, el que le sigue tiene que ser vacio
\pred{noHayAlumnosJuntos}{a: Aula}{
    \paraTodo{c}{Alumno}{c\in a \rightarrow
    \struct{c.f,\ c.c+1} \notin a}
}

% todos los examenes en el aula estan sin responder y son del largo correcto
\predLargo{examenesInicializados}{a: Aula, sol: Examen}{
    \paraTodo{c}{Alumno}{c\in a \rightarrow examenInicializado(a[c], sol)}
}

% El examen no tiene ninguna respuesta
\predLargo{examenInicializado}{e: Examen, sol: Examen}{
    \norm{e} = \norm{sol} \land
    \paraTodo{i}{\Z}{0 \leq i < \norm{e} \implicaLuego e[i] = -1}
}

\subsection{proc igualdad}
% Metodo igualdad --------------------------------------------------
\begin{proc}{igualdad}
{
\In edr_1,edr_2: EdR,
}{
\Tipo{Bool}
}
    \requiere{True}
    \aseguraLargo{res = True \leftrightarrow
    \\ (edr_1.aula = edr_2.aula \land
    \\ edr_1.solucion = edr_2.solucion \land
    \\ edr_1.entregas = edr_2.entregas)
    }
\end{proc}

\subsection{proc copiarse}

% Metodo copiarse --------------------------------------------------
\begin{proc}{copiarse}
{
\In a1: Alumno,
\Inout edr: EdR 
}{
\Tipo{}
}
    \requiereLargo{ 
        a1 \in edr.aula \yLuego\\
        \existe{a2}{Alumno}{a2\in edr.aula \land\\
        puedeCopiarse(a1, a2) \land\\
        respondioAlgunEjercicio(edr.aula[a2])}\land\\
        edr_0 = edr
    }
    \aseguraLargo{
        \existe{i}{\Z}{0\leq i < \norm{a1.examen}\yLuego \existe{a2}{Alumno}{\\
            a2\in edr_0.aula \land\\
            puedeCopiarse(a1, a2)\land\\
            respondio(i, edr_0.aula[a2]) \land\\
            edr.aula = setKey(edr_0.aula, a1, setAt(edr.aula[a1], i, edr_0.aula[a2][i]))\\
        }}\land\\
        edr_0.solucion = edr.solucion \land
        edr_0.entregas = edr.entregas
    } 
\end{proc}
\\

% a1 y a2 tienen la misma norma y son cuadradas
% \predLargo{mismasDimensiones}{a1,a2: Aula}{
%     \norm{a1}=\norm{a2}
% }

% e0 es igual a e1 en todos los ejercicios menos en i
\predLargo{mismosEjerciciosMenos}{i: \Z, e0, e1: Examen}{
    \norm{e1} = \norm{e0} \yLuego\\
    \paraTodo{j}{\Z}{(0 \leq j < \norm{e0} \land j \neq i)
    \implicaLuego e0[j] = e1[j]}
}


% las coordenadas estan dentro del aula y c0 esta a distancia |2| de c1 en x o esta directamente adelante en y
\predLargo{puedeCopiarse}{c1, c2: Alumno}{
    ((\norm{c2.c - c1.c} = 2 \land c2.f = c1.f) \lor
    (c2.c = c1.c \land  c2.f - c1.f = 1))
}

\predLargo{respondioAlgunEjercicio}{e:Examen}{
    \existe{i}{\Z}{respondio(i, e)}
}


\subsection{proc consultarDarkWeb}
% Metodo consultarDarkWeb --------------------------------------------------
\begin{proc}{consultarDarkWeb}
{
\In s: Examen,
\In posiblesAccesos: \Z,
\Inout edr: EdR
}{}
    \requiereLargo{
    edr = edr_0 \land
    \\rtaValida(s) \land
    \\\norm{s} = \norm{edr.solucion} \land
    \\posiblesAccesos \geq 0
    }
    \aseguraLargo{
    \existe {n}{\Z}{0 \leq n \leq posiblesAccesos \land 0 \leq n \leq \norm{edr.aula} \land
    \\ \existe {seCopian}{\conj{Alumno}}{\norm{seCopian} = n \land 
    \\ \paraTodo{a1}{Alumno}{a1 \in seCopian \leftrightarrow 
    (a1 \in edr_0.aula \yLuego \\edr_0.aula[a] \neq s \land
    edr.aula[a] = s)} \land
    \\todosEstudiantesIgualesMenos(seCopian,edr.aula, edr_0.aula)}} \land
    \\edr.solucion = edr_0.solucion \land
    \\edr.entregas = edr_0.entregas
}
\end{proc}
\\

% Las aulas son iguales en todas las coordenadas menos en las especificadas en coords 
\predLargo{todosEstudiantesIgualesMenos}{alumnos: \conj{Alumno}, a0, a1: Aula}{
        \paraTodo{a}{Alumno}{(a \in a0 \land a \in a1 \land a \notin alumnos) \implicaLuego a1[a] = a0[a]}
}

\subsection{proc resolver}
% Metodo resolver --------------------------------------------------
\begin{proc}{resolver}
{
\Inout edr: EdR,
\In a: Alumno,
\In e: \seq{Examen}
}{
\Tipo{\seq{Examen}}
}
    \requiereLargo{
    a \in edr.aula \land\\
    examenInicializado(edr.aula[a], edr.solucion)\land\\
    \norm{e} > 1 \land\\
    edr_0 = edr
    }
    \aseguraLargo{
        % vv el examen q devolvemos tiene t+1 pasos
        \norm{res} = \norm{e} + 1\land\\
        % aca me aseguro que en el paso t+1 resuelvo un ejercicio que en el paso t no estaba resuelto vv
        hayNuevoEjercicioResuelto(e[\norm{e}-1], res[\norm{res}-1])\land\\
        % vv aca me fijo que el resto de pasos esten igual
        e = subseq(res, 0, \norm{res}-1)\land\\
        % vv igualo el examen en edr con el examen q devuelvo
        edr.aula = setKey(edr_0.aula, a, res[\norm{res}-1]) \land\\
        edr_0.solucion = edr.solucion \land\\
        edr_0.entregas = edr.entregas
    }
\end{proc}


% existe solo 1 ejercicio con respuesta nueva en e1 que en e0 no estaba
\predLargo{hayNuevoEjercicioResuelto}{e0, e1: Examen}{
        (\exists k: \Z)(0 \leq k < \norm{e0} \yLuego\\
        (mismosEjerciciosMenos(k, e1, e0) \land
        \lnot respondio(k, e0) \land
        respondio(k, e1)))
}

% el ejercicio i del examen fue resuelto
\pred{respondio}{i: \Z, e: Examen}{0 \leq i < \norm{e} \yLuego 0 \leq e[i] \leq 9}

\subsection{proc entregar}
% Metodo entregar --------------------------------------------------
\begin{proc}{entregar}
{
\In a: Alumno,
\Inout edr: EdR
}{
}
    \requiere{
        a\in edr.aula \land edr = edr_0
    } 
    \aseguraLargo{
        % CAMBIO EL a.examen, ANTES REVISABA EL ULTIMO PASO
        edr.entregas = setKey(edr_0.entregas, a, edr_0.aula[a]) \land
        \\ edr.aula = delKey(edr_0.aula, a) \land
        \\ edr.solucion = edr_0.solucion
    }
\end{proc}

\subsection{proc chequearCopias}
% Metodo chequearCopias --------------------------------------------------
\begin{proc}{chequearCopias}
{
\In edr: EdR
}{
\Tipo{\seq{Alumno}}
}
    \requiere{todosEntregaron(edr)} 
    \asegura{
        \paraTodo {a1}{Alumno}{a1 \in edr.entregas \rightarrow (a1 \in res \leftrightarrow esSospechoso(a1))} \land 
        sinElementosRepetidos(res)
        }
\end{proc}
\\

% devuelve el porcentaje de respuestas iguales entre 2 alumnos
\aux{porcentajeRespuestasIgualAdyacente}{e1, e2: Examen}{\Z}
\\    $(\sum_{i=0}^{\norm{e1}-1} IfThenElse((e1[i] = e2[i]),1,0)) \cdot \frac{100}{\norm{e1}}$
\\ \\
/* Hacemos este pred con tipo de entrada $\seq{T}$, ya que no importa para el funcionamiento del pred qué tiene la secuencia adentro.*/ \\ \\
\predLargo{sinElementosRepetidos}{s: \seq{T}}{
    \paraTodo{i, j}{\Z}{0 \leq i < \norm{s} \land 0 \leq j < \norm{s} \implicaLuego (s[i] = s[j] \leftrightarrow i = j)}
} \\

\aux{porcentajeIgualAula}{a:Alumno, entregas:dicc\struct{Alumno, Examen}}{\Z}
\\ $(\sum_{i \in entregas}IfThenElse( a \neq i\land entregas[a] = entregas[i],1,0)) \cdot \frac{100}{\norm{entregas}-1}$
\\

% No queda ningun estudiante en el aula
\predLargo{todosEntregaron}{edr: EdR}{
    \norm{edr.entregas} > 0 \land \norm{edr.aula} = 0
}

\predLargo{esSospechoso}{edr: EdR, a1: Alumno}{
    \existe{a2}{Alumno}{a2 \in edr.entregas  \land  puedeCopiarse(a1, a2, edr.aula) \land 
    \\ porcentajeRespuestasIgualAdyacente(edr.entregas[a1], edr.entregas[a2]) > 60} \ \lor \\porcentajeIgualAula(edr.entregas[a1], edr.entregas) > 25
}

\subsection{proc corregir}
% Metodo corregir --------------------------------------------------
\begin{proc}{corregir} 
{
\In edr:EdR
}{
\Tipo{\seq{tupla\tupla{Alumno, Nota}}}
}
    \requiere{todosEntregaron(edr)}
    \aseguraLargo{
        % aca uso es si y solo si para que solo tenga esos elementos
        \paraTodo{a}{Alumno}{(a \in edr.entregas \land \lnot esSospechoso(edr, a)) \leftrightarrow\\
        tupla\tupla{a, nota(edr.entregas[a], edr.solucion)} \in res} \land \\
        % me fijo que la tupla este una sola vez
        sinElementosRepetidos(res)
}
\end{proc}
\\

% Suma todas las respuestas correctas, lo divide por la cantidad de respuestas y lo multiplica por 10 (standar)
\aux{nota}{e, sol: Examen}{\R}
    \\ $((\sum_{i=0}^{\norm{sol}-1}ifThenElse(e[i] = sol[i], 1, 0))) \cdot \frac{10}{\norm{sol}}$

\end{tad}

\end{document}
